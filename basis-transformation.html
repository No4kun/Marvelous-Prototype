<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>基底変換と表現行列 - 線形写像の深層理解</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.7.0/p5.min.js"></script>
    <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
    <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <link rel="stylesheet" href="basis-transformation.css">
</head>
<body>
    <header>
        <h1>🔄 基底変換と表現行列</h1>
        <h2>線形写像の本質を視覚的に理解する</h2>
        <div class="progress-container">
            <div class="progress-bar">
                <div class="progress-fill" id="progress-fill"></div>
            </div>
            <span class="progress-text">進捗: <span id="progress-count">0</span>/7</span>
        </div>
    </header>

    <nav class="section-nav">
        <button class="nav-btn active" data-section="0">導入</button>
        <button class="nav-btn" data-section="1">基底の概念</button>
        <button class="nav-btn" data-section="2">基底変換</button>
        <button class="nav-btn" data-section="3">表現行列</button>
        <button class="nav-btn" data-section="4">線形写像の合成</button>
        <button class="nav-btn" data-section="5">多項式空間</button>
        <button class="nav-btn" data-section="6">応用・演習</button>
    </nav>

    <main>
        <!-- セクション0: 導入 -->
        <section id="section-0" class="content-section active">
            <div class="section-header">
                <h3>🎯 導入：なぜ基底変換が重要なのか</h3>
                <p class="section-subtitle">座標系の選択が問題解決の鍵となる</p>
            </div>

            <div class="content-card">
                <h4>📍 座標系と基底の関係</h4>
                <p>同じベクトルでも、どの基底（座標系）で表現するかによって、その成分は全く異なります。</p>
                
                <div class="demo-container" id="intro-demo">
                    <h5>インタラクティブデモ：座標系の切り替え</h5>
                    <div class="controls">
                        <button onclick="switchBasis('standard')">標準基底</button>
                        <button onclick="switchBasis('rotated')">回転基底</button>
                        <button onclick="switchBasis('scaled')">スケール基底</button>
                    </div>
                </div>

                <div class="insight-box">
                    <h5>💡 核心的洞察</h5>
                    <p>基底変換は「同じ数学的対象を異なる視点から見る」技術です。適切な基底を選ぶことで、複雑な問題が単純化されることがあります。</p>
                </div>
            </div>

            <div class="section-footer">
                <button class="next-btn" onclick="nextSection(0)">次のセクションへ 🚀</button>
            </div>
        </section>

        <!-- セクション1: 基底の概念 -->
        <section id="section-1" class="content-section">
            <div class="section-header">
                <h3>🧭 基底の概念と性質</h3>
                <p class="section-subtitle">ベクトル空間の構造を理解する</p>
            </div>

            <div class="content-card">
                <h4>📏 基底の定義と条件</h4>
                <p>ベクトル空間 \(V\) の基底 \(\mathcal{B} = \{v_1, v_2, \ldots, v_n\}\) は以下を満たします：</p>
                
                <div class="math-box">
                    $$\begin{align}
                    &\text{1. 線形独立性: } c_1v_1 + c_2v_2 + \cdots + c_nv_n = 0 \Rightarrow c_1 = c_2 = \cdots = c_n = 0 \\
                    &\text{2. 生成性: } \text{span}(\mathcal{B}) = V
                    \end{align}$$
                </div>

                <div class="demo-container" id="basis-properties-demo">
                    <h5>視覚化：基底の性質</h5>
                    <div class="controls">
                        <label>ベクトル1 角度: <input type="range" id="vec1-angle" min="0" max="360" value="30"></label>
                        <label>ベクトル2 角度: <input type="range" id="vec2-angle" min="0" max="360" value="120"></label>
                        <div id="independence-status"></div>
                    </div>
                </div>
            </div>

            <div class="content-card">
                <h4>🔄 標準基底と一般基底</h4>
                <div class="comparison-grid">
                    <div class="comparison-item">
                        <h5>標準基底 \(\mathcal{E}\)</h5>
                        <div class="math-box">
                            $$\mathcal{E} = \left\{ \begin{pmatrix} 1 \\ 0 \end{pmatrix}, \begin{pmatrix} 0 \\ 1 \end{pmatrix} \right\}$$
                        </div>
                    </div>
                    <div class="comparison-item">
                        <h5>一般基底 \(\mathcal{B}\)</h5>
                        <div class="math-box">
                            $$\mathcal{B} = \left\{ \begin{pmatrix} a \\ c \end{pmatrix}, \begin{pmatrix} b \\ d \end{pmatrix} \right\}$$
                        </div>
                    </div>
                </div>
            </div>

            <div class="section-footer">
                <button class="next-btn" onclick="nextSection(1)">次のセクションへ 🚀</button>
            </div>
        </section>

        <!-- セクション2: 基底変換 -->
        <section id="section-2" class="content-section">
            <div class="section-header">
                <h3>🔄 基底変換の仕組み</h3>
                <p class="section-subtitle">座標系間の変換を理解する</p>
            </div>

            <div class="content-card">
                <h4>🧮 基底変換行列</h4>
                <p>基底 \(\mathcal{B}\) から基底 \(\mathcal{C}\) への変換行列 \(P_{\mathcal{B} \leftarrow \mathcal{C}}\)：</p>
                
                <div class="math-box">
                    $$[v]_{\mathcal{B}} = P_{\mathcal{B} \leftarrow \mathcal{C}} [v]_{\mathcal{C}}$$
                </div>

                <div class="demo-container" id="basis-transformation-demo">
                    <h5>インタラクティブ変換</h5>
                    <div class="controls">
                        <div class="basis-controls">
                            <h6>新基底の設定</h6>
                            <label>基底1 X: <input type="range" id="basis1-x" min="-2" max="2" step="0.1" value="1"></label>
                            <label>基底1 Y: <input type="range" id="basis1-y" min="-2" max="2" step="0.1" value="1"></label>
                            <label>基底2 X: <input type="range" id="basis2-x" min="-2" max="2" step="0.1" value="-1"></label>
                            <label>基底2 Y: <input type="range" id="basis2-y" min="-2" max="2" step="0.1" value="2"></label>
                        </div>
                        <button onclick="animateTransformation()">変換アニメーション</button>
                    </div>
                    <div class="transformation-info" id="transformation-info"></div>
                </div>
            </div>

            <div class="content-card">
                <h4>📊 変換行列の計算</h4>
                <div class="calculation-steps">
                    <div class="step">
                        <h5>ステップ1: 新基底の標準基底での表現</h5>
                        <div class="math-box">
                            $$B = \begin{pmatrix} | & | \\ b_1 & b_2 \\ | & | \end{pmatrix}$$
                        </div>
                    </div>
                    <div class="step">
                        <h5>ステップ2: 変換行列の構成</h5>
                        <div class="math-box">
                            $$P_{\mathcal{E} \leftarrow \mathcal{B}} = B, \quad P_{\mathcal{B} \leftarrow \mathcal{E}} = B^{-1}$$
                        </div>
                    </div>
                </div>
            </div>

            <div class="section-footer">
                <button class="next-btn" onclick="nextSection(2)">次のセクションへ 🚀</button>
            </div>
        </section>

        <!-- セクション3: 表現行列 -->
        <section id="section-3" class="content-section">
            <div class="section-header">
                <h3>🎭 線形写像の表現行列</h3>
                <p class="section-subtitle">基底によって変わる線形写像の表現</p>
            </div>

            <div class="content-card">
                <h4>🔍 表現行列の定義</h4>
                <p>線形写像 \(T: V \to W\) の基底 \(\mathcal{B}, \mathcal{C}\) に関する表現行列：</p>
                
                <div class="math-box">
                    $$[T]_{\mathcal{C}}^{\mathcal{B}} \text{ such that } [T(v)]_{\mathcal{C}} = [T]_{\mathcal{C}}^{\mathcal{B}} [v]_{\mathcal{B}}$$
                </div>

                <div class="demo-container" id="representation-matrix-demo">
                    <h5>線形写像の視覚化</h5>
                    <div class="controls">
                        <label>写像タイプ:
                            <select id="mapping-type">
                                <option value="rotation">回転</option>
                                <option value="scaling">スケーリング</option>
                                <option value="shear">せん断</option>
                                <option value="reflection">反射</option>
                            </select>
                        </label>
                        <label>パラメータ: <input type="range" id="mapping-param" min="0" max="360" value="45"></label>
                    </div>
                    <div class="matrix-display" id="matrix-display"></div>
                </div>
            </div>

            <div class="content-card">
                <h4>🔄 基底変換と表現行列の関係</h4>
                <p>同じ線形写像でも基底が変われば表現行列も変化します：</p>
                
                <div class="math-box">
                    $$[T]_{\mathcal{D}}^{\mathcal{C}} = P_{\mathcal{D} \leftarrow \mathcal{C'}} [T]_{\mathcal{C'}}^{\mathcal{B'}} P_{\mathcal{B'} \leftarrow \mathcal{B}}$$
                </div>

                <div class="demo-container" id="basis-change-effect-demo">
                    <h5>基底変更の効果</h5>
                    <div class="controls">
                        <button onclick="compareBases()">基底比較</button>
                        <button onclick="showSimilarity()">相似変換</button>
                    </div>
                </div>
            </div>

            <div class="section-footer">
                <button class="next-btn" onclick="nextSection(3)">次のセクションへ 🚀</button>
            </div>
        </section>

        <!-- セクション4: 線形写像の合成 -->
        <section id="section-4" class="content-section">
            <div class="section-header">
                <h3>🔗 線形写像の合成</h3>
                <p class="section-subtitle">変換の連鎖と行列の積</p>
            </div>

            <div class="content-card">
                <h4>⛓️ 合成写像の表現</h4>
                <p>線形写像 \(S: U \to V\) と \(T: V \to W\) の合成：</p>
                
                <div class="math-box">
                    $$[T \circ S]_{\mathcal{C}}^{\mathcal{A}} = [T]_{\mathcal{C}}^{\mathcal{B}} [S]_{\mathcal{B}}^{\mathcal{A}}$$
                </div>

                <div class="demo-container" id="composition-demo">
                    <h5>合成変換の視覚化</h5>
                    <div class="controls">
                        <div class="transformation-controls">
                            <h6>第1変換</h6>
                            <label>回転角度: <input type="range" id="transform1-angle" min="0" max="360" value="30"></label>
                            <label>スケール: <input type="range" id="transform1-scale" min="0.5" max="2" step="0.1" value="1"></label>
                        </div>
                        <div class="transformation-controls">
                            <h6>第2変換</h6>
                            <label>回転角度: <input type="range" id="transform2-angle" min="0" max="360" value="60"></label>
                            <label>スケール: <input type="range" id="transform2-scale" min="0.5" max="2" step="0.1" value="1.2"></label>
                        </div>
                        <button onclick="animateComposition()">合成アニメーション</button>
                    </div>
                </div>
            </div>

            <div class="content-card">
                <h4>🎯 応用：連続変換</h4>
                <div class="example-box">
                    <h5>例：3D回転の合成</h5>
                    <p>3次元空間での回転は非可換です。回転の順序が結果に影響します。</p>
                    
                    <div class="demo-container" id="rotation-composition-demo">
                        <div class="controls">
                            <label>X軸回転: <input type="range" id="rot-x" min="0" max="360" value="30"></label>
                            <label>Y軸回転: <input type="range" id="rot-y" min="0" max="360" value="45"></label>
                            <label>Z軸回転: <input type="range" id="rot-z" min="0" max="360" value="60"></label>
                            <button onclick="switchRotationOrder()">回転順序変更</button>
                        </div>
                    </div>
                </div>
            </div>

            <div class="section-footer">
                <button class="next-btn" onclick="nextSection(4)">次のセクションへ 🚀</button>
            </div>
        </section>

        <!-- セクション5: 多項式空間 -->
        <section id="section-5" class="content-section">
            <div class="section-header">
                <h3>📈 多項式ベクトル空間の基底変換</h3>
                <p class="section-subtitle">抽象的なベクトル空間での基底変換</p>
            </div>

            <div class="content-card">
                <h4>🧮 多項式空間 \(P_n\) の基底</h4>
                <p>次数 \(n\) 以下の多項式の空間では、様々な基底が考えられます：</p>
                
                <div class="basis-examples">
                    <div class="basis-example">
                        <h5>標準基底（単項式基底）</h5>
                        <div class="math-box">
                            $$\mathcal{M} = \{1, x, x^2, x^3, \ldots\}$$
                        </div>
                    </div>
                    <div class="basis-example">
                        <h5>ベルンシュタイン基底</h5>
                        <div class="math-box">
                            $$\mathcal{B}_n = \left\{ \binom{n}{k} x^k (1-x)^{n-k} \right\}_{k=0}^n$$
                        </div>
                    </div>
                    <div class="basis-example">
                        <h5>ルジャンドル基底</h5>
                        <div class="math-box">
                            $$\mathcal{L} = \{P_0(x), P_1(x), P_2(x), \ldots\}$$
                        </div>
                    </div>
                </div>

                <div class="demo-container" id="polynomial-basis-demo">
                    <h5>多項式基底の比較</h5>
                    <div class="controls">
                        <label>多項式次数: <input type="range" id="poly-degree" min="1" max="4" value="3"></label>
                        <label>基底タイプ:
                            <select id="poly-basis-type">
                                <option value="monomial">単項式</option>
                                <option value="bernstein">ベルンシュタイン</option>
                                <option value="legendre">ルジャンドル</option>
                            </select>
                        </label>
                        <button onclick="visualizePolynomialBasis()">基底表示</button>
                    </div>
                    <div class="polynomial-display" id="polynomial-display"></div>
                </div>
            </div>

            <div class="content-card">
                <h4>🔄 多項式基底間の変換</h4>
                <p>多項式 \(p(x) = 2x^3 - x^2 + 3x - 1\) を異なる基底で表現：</p>
                
                <div class="demo-container" id="polynomial-transformation-demo">
                    <div class="controls">
                        <div class="polynomial-input">
                            <h6>多項式係数入力</h6>
                            <label>定数項: <input type="number" id="coeff-0" value="-1" step="0.1"></label>
                            <label>x係数: <input type="number" id="coeff-1" value="3" step="0.1"></label>
                            <label>x²係数: <input type="number" id="coeff-2" value="-1" step="0.1"></label>
                            <label>x³係数: <input type="number" id="coeff-3" value="2" step="0.1"></label>
                        </div>
                        <button onclick="convertPolynomialBasis()">基底変換実行</button>
                    </div>
                    <div class="conversion-result" id="conversion-result"></div>
                </div>
            </div>

            <div class="content-card">
                <h4>📊 変換行列の具体例</h4>
                <div class="example-box">
                    <h5>単項式基底 → ベルンシュタイン基底</h5>
                    <p>3次多項式の場合の変換行列：</p>
                    
                    <div class="matrix-example" id="polynomial-matrix-example">
                        <!-- 動的に生成される行列表示 -->
                    </div>
                </div>
            </div>

            <div class="section-footer">
                <button class="next-btn" onclick="nextSection(5)">次のセクションへ 🚀</button>
            </div>
        </section>

        <!-- セクション6: 応用・演習 -->
        <section id="section-6" class="content-section">
            <div class="section-header">
                <h3>🎯 応用問題と総合演習</h3>
                <p class="section-subtitle">理論を実践で確認する</p>
            </div>

            <div class="content-card">
                <h4>💡 実践問題1: 固有値問題との関連</h4>
                <p>基底変換により行列を対角化する過程を視覚的に理解しましょう。</p>
                
                <div class="demo-container" id="eigenvalue-demo">
                    <div class="controls">
                        <h6>2×2行列の設定</h6>
                        <label>a₁₁: <input type="number" id="matrix-11" value="3" step="0.1"></label>
                        <label>a₁₂: <input type="number" id="matrix-12" value="1" step="0.1"></label>
                        <label>a₂₁: <input type="number" id="matrix-21" value="1" step="0.1"></label>
                        <label>a₂₂: <input type="number" id="matrix-22" value="3" step="0.1"></label>
                        <button onclick="diagonalizeMatrix()">対角化実行</button>
                    </div>
                    <div class="diagonalization-result" id="diagonalization-result"></div>
                </div>
            </div>

            <div class="content-card">
                <h4>🧮 計算問題セット</h4>
                
                <div class="problem-set">
                    <div class="problem">
                        <h5>問題1: 基底変換行列の計算</h5>
                        <p>基底 \(\mathcal{B} = \{(1,2), (3,1)\}\) から標準基底への変換行列を求めよ。</p>
                        
                        <div class="input-group">
                            <label>P₁₁: <input type="number" id="prob1-11" step="0.1"></label>
                            <label>P₁₂: <input type="number" id="prob1-12" step="0.1"></label>
                            <label>P₂₁: <input type="number" id="prob1-21" step="0.1"></label>
                            <label>P₂₂: <input type="number" id="prob1-22" step="0.1"></label>
                        </div>
                        <button onclick="checkProblem1()">解答確認</button>
                        <div class="result" id="prob1-result"></div>
                    </div>

                    <div class="problem">
                        <h5>問題2: 表現行列の計算</h5>
                        <p>線形写像 T(x,y) = (2x+y, x-y) の基底 \(\mathcal{B}\) に関する表現行列を求めよ。</p>
                        
                        <div class="input-group">
                            <label>T₁₁: <input type="number" id="prob2-11" step="0.1"></label>
                            <label>T₁₂: <input type="number" id="prob2-12" step="0.1"></label>
                            <label>T₂₁: <input type="number" id="prob2-21" step="0.1"></label>
                            <label>T₂₂: <input type="number" id="prob2-22" step="0.1"></label>
                        </div>
                        <button onclick="checkProblem2()">解答確認</button>
                        <div class="result" id="prob2-result"></div>
                    </div>
                </div>
            </div>

            <div class="content-card">
                <h4>🎮 インタラクティブ・チャレンジ</h4>
                <div class="challenge-box">
                    <h5>チャレンジ: 最適基底の発見</h5>
                    <p>与えられた線形写像に対して、表現行列が最も簡単になる基底を見つけてください。</p>
                    
                    <div class="demo-container" id="optimal-basis-challenge">
                        <div class="controls">
                            <button onclick="generateRandomChallenge()">新しい問題生成</button>
                            <button onclick="showHint()">ヒント表示</button>
                            <button onclick="showSolution()">解答表示</button>
                        </div>
                        <div class="challenge-content" id="challenge-content"></div>
                    </div>
                </div>
            </div>

            <div class="section-footer">
                <button class="complete-btn" onclick="completeCourse()">コース完了！ 🎊</button>
            </div>
        </section>
    </main>

    <footer>
        <p>© 2025 Marvelous Learning Platform - 基底変換と線形写像の探求</p>
    </footer>

    <script src="basis-transformation.js"></script>
</body>
</html>
